# VLMM Worker (Cloudflare) ‚Äî Vision API proxy (BigModel + OpenRouter)

–¢–æ–Ω–∫–∏–π edge‚Äë–ø—Ä–æ–∫—Å–∏ –Ω–∞ Cloudflare Workers –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ‚Äë—è–∑—ã–∫–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π (VLM/VLMM). –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (URL/—Ñ–∞–π–ª/base64) –∏ –ø—Ä–æ–º–ø—Ç, —Å–æ–±–∏—Ä–∞–µ—Ç OpenAI‚Äë—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ `messages`, –≤—ã–∑—ã–≤–∞–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é **BigModel GLM‚Äë4.5V**), –∏ –æ—Ç–¥–∞—ë—Ç –æ—Ç–≤–µ—Ç JSON –∏–ª–∏ —Å—Ç—Ä–∏–º–æ–º (SSE).

> –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–µ–π—á–∞—Å —Å–æ–¥–µ—Ä–∂–∏—Ç **—Ç–æ–ª—å–∫–æ –≤–æ—Ä–∫–µ—Ä**. –î–µ–º–æ‚Äë—Ñ—Ä–æ–Ω—Ç –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ ‚Äî –ª—é–±–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞, –∫–æ—Ç–æ—Ä–∞—è —à–ª—ë—Ç `POST` –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≤–æ—Ä–∫–µ—Ä–∞.

---

## –ß—Ç–æ —É–∂–µ —É–º–µ–µ—Ç
- `POST /v1/vision/analyze` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π JSON‚Äë–æ—Ç–≤–µ—Ç.
- `POST /v1/vision/stream` ‚Äî –ø–æ—Ç–æ–∫–æ–≤—ã–π –æ—Ç–≤–µ—Ç (Server‚ÄëSent Events).
- `GET /healthz` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∂–∏–≤–æ—Å—Ç–∏.
- –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã: **BigModel** (`glm-4.5v`) –∏ **OpenRouter** (–ª—é–±–∞—è vision‚Äë–º–æ–¥–µ–ª—å). –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ: `provider=bigmodel|openrouter` –≤ —Ç–µ–ª–µ –∏–ª–∏ query.
- –í—Ö–æ–¥–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: `multipart/form-data` (–ø–æ–ª–µ `file`) –∏ `application/json` (`image_url` –∏–ª–∏ `image_base64`).
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `prompt`, `model`, `detail: low|high|auto`, `images[]` (–º—É–ª—å—Ç–∏‚Äë–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è), `thinking: enabled|disabled` (—Ç–æ–ª—å–∫–æ BigModel), `stream: true`.
- CORS: —Ä–∞–∑—Ä–µ—à—ë–Ω —Å–ø–∏—Å–æ–∫ origin‚Äô–æ–≤ (env `ALLOWED_ORIGINS`).

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1) –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
npm i
# (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) wrangler –≤ dev‚Äë–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm i -D wrangler
```

### 2) –°–µ–∫—Ä–µ—Ç—ã –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
–°–µ–∫—Ä–µ—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Å—Ä–µ–¥–µ –≤–æ—Ä–∫–µ—Ä–∞, –Ω–µ –≤ —Ñ–∞–π–ª–∞—Ö.
```bash
# BigModel (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ bigmodel)
npx wrangler secret put BIGMODEL_API_KEY

# OpenRouter (–æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω ‚Äî —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ openrouter)
npx wrangler secret put OPENROUTER_API_KEY
```
–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (—á–µ—Ä–µ–∑ `wrangler.jsonc ‚Üí vars` –∏–ª–∏ –¥–ª—è –ª–æ–∫–∞–ª–∫–∏ `.dev.vars`):
- `DEFAULT_MODEL` ‚Äî –¥–µ—Ñ–æ–ª—Ç–Ω–∞—è –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `glm-4.5v` –∏–ª–∏ `qwen/qwen2.5-vl-72b-instruct`).
- `ALLOWED_ORIGINS` ‚Äî —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö origin‚Äô–æ–≤, —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, `http://localhost:3333,http://127.0.0.1:3000`).
- `APP_URL`, `APP_TITLE` ‚Äî (–¥–ª—è OpenRouter) –∞—Ç—Ä–∏–±—É—Ü–∏—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö.

–ü—Ä–∏–º–µ—Ä `.dev.vars` (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å):
```
BIGMODEL_API_KEY="sk-..."
# OPENROUTER_API_KEY="sk-or-..."
DEFAULT_MODEL="glm-4.5v"
ALLOWED_ORIGINS="http://localhost:3333,http://127.0.0.1:3000"
APP_URL="http://localhost:3333"
APP_TITLE="VLMM Proxy (dev)"
```

### 3) –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫
```bash
npx wrangler dev
# —Å–ª—É—à–∞–µ—Ç http://127.0.0.1:8787
```
–ß—Ç–æ–±—ã ¬´–∂—ë—Å—Ç–∫–æ¬ª —Ä–∞–∑—Ä–µ—à–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ—Ä–æ–Ω—Ç –Ω–∞ `http://localhost:3333`, –¥–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ `ALLOWED_ORIGINS`.

### 4) –î–µ–ø–ª–æ–π
```bash
npx wrangler deploy
```
–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –∞–¥—Ä–µ—Å –≤–∏–¥–∞:
```
https://vlmm-worker.<your-subdomain>.workers.dev
```
*(–∏–º—è —Å–µ—Ä–≤–∏—Å–∞ –±–µ—Ä—ë—Ç—Å—è –∏–∑ `wrangler.jsonc: name`)*

---

## API

### POST `/v1/vision/analyze`
**–í—Ö–æ–¥**
- **JSON**
```jsonc
{
  "provider": "bigmodel",      // bigmodel | openrouter (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é bigmodel)
  "model": "glm-4.5v",         // –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç DEFAULT_MODEL
  "prompt": "–ß—Ç–æ –Ω–∞ —Ñ–æ—Ç–æ?",
  "image_url": "https://.../img.jpg", // http(s) –∏–ª–∏ data:URL
  // –ª–∏–±–æ –≤–º–µ—Å—Ç–æ image_url:
  // "image_base64": "<RAW_BASE64>",   // –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ data:
  "images": ["https://.../img1.jpg", "https://.../img2.jpg"],
  "detail": "auto",              // low | high | auto
  "thinking": "enabled",         // —Ç–æ–ª—å–∫–æ –¥–ª—è BigModel
  "stream": false
}
```
- **multipart/form-data**
  - `file` ‚Äî –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (`image/jpeg|png|webp|gif`)
  - `prompt`, `model`, `provider`, `detail`, `thinking` ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

**–û—Ç–≤–µ—Ç (—É–ø—Ä–æ—â—ë–Ω–Ω–æ)**
```json
{
  "id": "...",
  "model": "glm-4.5v",
  "choices": [ { "message": { "role": "assistant", "content": "..." } } ],
  "usage": { "prompt_tokens": 0, "completion_tokens": 0 }
}
```

### POST `/v1/vision/stream`
–¢–µ –∂–µ –ø–æ–ª—è, –Ω–æ –æ—Ç–¥–∞—ë—Ç `text/event-stream`. –í –ø–æ—Ç–æ–∫ –∏–¥—É—Ç —á–∞–Ω–∫–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Å OpenAI (`choices[].delta.content`).

### GET `/healthz`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `ok`.

---

## –ü—Ä–∏–º–µ—Ä—ã cURL

### JSON + BigModel
```bash
curl -X POST "$WORKER/v1/vision/analyze" \
  -H "Content-Type: application/json" \
  -d '{
    "provider":"bigmodel",
    "model":"glm-4.5v",
    "prompt":"List the objects",
    "image_url":"https://cdn.bigmodel.cn/static/logo/register.png",
    "thinking":"enabled"
  }'
```

### multipart (–ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª)
```bash
curl -X POST "$WORKER/v1/vision/analyze" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@/path/to/image.jpg" \
  -F "prompt=–û–ø–∏—à–∏ –∫–∞—Ä—Ç–∏–Ω–∫—É" \
  -F "provider=bigmodel" -F "model=glm-4.5v" -F "detail=high"
```

### –°—Ç—Ä–∏–º (SSE)
```bash
curl -N -X POST "$WORKER/v1/vision/stream" \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "bigmodel",
    "model": "glm-4.5v",
    "prompt": "Explain the chart",
    "image_url": "https://cdn.bigmodel.cn/static/logo/api-key.png",
    "stream": true
  }'
```

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ OpenRouter
```bash
curl -X POST "$WORKER/v1/vision/analyze?provider=openrouter" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "qwen/qwen2.5-vl-72b-instruct",
    "prompt": "Summarize",
    "image_url": "https://.../img.jpg"
  }'
```

---

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ, –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –ï—Å–ª–∏ –ø—Ä–∏—à–ª–æ `image_base64`, –≤–æ—Ä–∫–µ—Ä —Å–∞–º –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤ `data:image/jpeg;base64, ...`.
- –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∏–ª–∏ `file` —á–µ—Ä–µ–∑ multipart ‚Äî –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Ñ–∞–π–ª –≤ data:URL.
- –ü–æ–ª–µ `detail` –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `image_url.detail` (–∫–æ–≥–¥–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º).
- –î–ª—è BigModel –¥–æ—Å—Ç—É–ø–µ–Ω —Ñ–ª–∞–≥ `thinking: enabled|disabled` (–≤–∫–ª—é—á–∞–µ—Ç/–æ—Ç–∫–ª—é—á–∞–µ—Ç —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è).
- –î–ª—è `stream` –≤–æ—Ä–∫–µ—Ä –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–æ–±—ã—Ç–∏–π.
- –ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî –∏–∑ `DEFAULT_MODEL`; –µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω–∞, –±–µ—Ä—ë—Ç—Å—è `glm-4.5v` (–¥–ª—è BigModel) –∏–ª–∏ `qwen/qwen2.5-vl-72b-instruct` (–¥–ª—è OpenRouter).

---

## CORS –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∑–∞–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ `ALLOWED_ORIGINS` (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é). –ü—Ä–∏–º–µ—Ä—ã:
  - –ª–æ–∫–∞–ª—å–Ω–æ: `http://localhost:3333,http://127.0.0.1:3000`
  - –ø—Ä–æ–¥: `https://your-frontend.app`
- –ù–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä/–ª–æ–∫–∞–ª–∫–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.dev.vars`.
- **–ö–ª—é—á–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä** ‚Äî —Ç–æ–ª—å–∫–æ –∫–∞–∫ —Å–µ–∫—Ä–µ—Ç—ã –≤–æ—Ä–∫–µ—Ä–∞.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (—Ç–µ–∫—É—â–µ–µ)
```
/ (–∫–æ—Ä–µ–Ω—å –≤–æ—Ä–∫–µ—Ä–∞)
  ‚îú‚îÄ‚îÄ src/index.ts                  # –∫–æ–¥ –≤–æ—Ä–∫–µ—Ä–∞ (—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã, CORS)
  ‚îú‚îÄ‚îÄ wrangler.jsonc                # –∫–æ–Ω—Ñ–∏–≥ —Å–µ—Ä–≤–∏—Å–∞ (name, main, vars, observability)
  ‚îú‚îÄ‚îÄ worker-configuration.d.ts     # —Ç–∏–ø—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ Wrangler)
  ‚îú‚îÄ‚îÄ tsconfig.json                 # TS-–∫–æ–º–ø–∏–ª—è—Ü–∏—è –ø–æ–¥ Workers runtime
  ‚îî‚îÄ‚îÄ README.md                     # —ç—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## Troubleshooting
- **401 No auth credentials** ‚Äî –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å–µ–∫—Ä–µ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (`BIGMODEL_API_KEY` –∏–ª–∏ `OPENROUTER_API_KEY`).
- **CORS‚Äë–æ—à–∏–±–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ** ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `ALLOWED_ORIGINS` –∏ –∏—Å—Ç–æ—á–Ω–∏–∫ –∑–∞–ø—Ä–æ—Å–∞.
- **413 Payload Too Large** ‚Äî —É–º–µ–Ω—å—à–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ –ª–∏–º–∏—Ç–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è ‚â§10 MB).
- **BigModel 4xx/5xx** ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞ –∏ —Ñ–æ—Ä–º–∞—Ç `messages`.

---

## üó∫Ô∏è TODO / –¥–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –¥–æ—Å—Ç—É–ø
* [ ] **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –≤–æ—Ä–∫–µ—Ä—É: Bearer‚Äë—Ç–æ–∫–µ–Ω (per‚Äëproject) + –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ HMAC‚Äë–ø–æ–¥–ø–∏—Å—å —Ç–µ–ª–∞.
* [ ] **CORS –ø–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è–º** (dev/stage/prod) —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ env‚Äë—Å–µ–∫—Ü–∏–∏ Wrangler.
* [ ] **Rate limiting** –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –∞–±—É–∑–∞: Cloudflare Turnstile (—á–µ–ª–æ–≤–µ–∫), –∫–≤–æ—Ç—ã –ø–æ IP/–∫–ª—é—á—É, –±–∞–∑–æ–≤—ã–π anti‚Äëreplay.

### –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ UX
* [ ] **UI —Å—Ç—Ä–∏–º–∞** (SSE): –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π –≤—ã–≤–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞, –∫–Ω–æ–ø–∫–∞ Cancel, –∞–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ.
* [ ] **–í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏/–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞** –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ + **—Ñ–æ–ª–±—ç–∫** –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (—Ä–æ—É—Ç–µ—Ä —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ –∏ health‚Äëcheck).
* [ ] **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ: preview, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤/—Ñ–æ—Ä–º–∞—Ç–æ–≤, resize/–∫–æ–º–ø—Ä–µ—Å—Å–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π, –æ—á–∏—Å—Ç–∫–∞ EXIF.
* [ ] **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏**: –µ–¥–∏–Ω—ã–π JSON‚Äë—Ñ–æ—Ä–º–∞—Ç, –∫–∞—Ä—Ç–∞ –∫–æ–¥–æ–≤ 4xx/5xx, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

### –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å
* [ ] **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** (structured JSON) –∏ `request_id`/`trace_id`; —É—Ä–æ–≤–Ω–∏ (info/warn/error), sampling –¥–ª—è —Å—Ç—Ä–∏–º–∞.
* [ ] **–ú–µ—Ç—Ä–∏–∫–∏**: —Å—á—ë—Ç—á–∏–∫–∏ usage, latency –ø–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É/–º–æ–¥–µ–ª–∏, —Ä–∞–∑–º–µ—Ä—ã –≤—Ö–æ–¥–æ–≤; —ç–∫—Å–ø–æ—Ä—Ç (Logs, Analytics Engine / RUM).
* [ ] **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): KV/R2 —Å TTL, –∫–ª—é—á –ø–æ —Ö—ç—à—É –∫–∞—Ä—Ç–∏–Ω–∫–∏+–ø—Ä–æ–º–ø—Ç–∞; —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∫—ç—à–∞ (HIT/MISS).

### –ú—É–ª—å—Ç–∏–º–µ–¥–∏–∞
* [ ] **–ù–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** ‚Äî –¥–æ—Ä–∞–±–æ—Ç–∫–∏ —Ñ—Ä–æ–Ω—Ç–∞: –º—É–ª—å—Ç–∏—Ç–∞—á/drag‚Äëdrop, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, per‚Äëimage `detail`, –ø—Ä–µ–≤—å—é –∏ —É–¥–∞–ª–µ–Ω–∏–µ.

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç—ã
* [ ] `/about` + **OpenAPI YAML** (–ª–∏–Ω–∫ —Å /about, –ø—Ä–∏–º–µ—Ä –∫–æ–ª–ª–µ–∫—Ü–∏–∏ Insomnia).
* [ ] CI: ESLint/TypeCheck + build + E2E (Playwright) —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏ —á–µ—Ä–µ–∑ CF Environments, –ø—Ä–µ–≤—å—é‚Äë–¥–µ–ø–ª–æ–π.

---

### D1: –º–æ–¥—É–ª—å Prompts (–∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã + KV‚Äë–∫—ç—à)
* [ ] **–°–æ–∑–¥–∞—Ç—å D1‚Äë–ë–î** `vlm-api-db` (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞) –∏ KV‚Äënamespace `PROMPT_CACHE`.
* [ ] **–ú–∏–≥—Ä–∞—Ü–∏—è `0001_prompts.sql`** (—Ç–∞–±–ª–∏—Ü–∞ `prompts` —Å –ø–æ–ª—è–º–∏ `prompt_*`, –∏–Ω–¥–µ–∫—Å—ã –ø–æ namespace/lang/active/default, —Ç—Ä–∏–≥–≥–µ—Ä –Ω–∞ `prompt_updated_at`).
* [ ] **API**: `GET /v1/prompts`, `GET /v1/prompts/:id`, `GET /v1/prompts/default`, `POST /v1/prompts`, `PUT /v1/prompts/:id`, `PUT /v1/prompts/:id/default`.
* [ ] **–î–æ—Å—Ç—É–ø**: –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Admin-Token` (—Å–µ–∫—Ä–µ—Ç –≤ –≤–æ—Ä–∫–µ—Ä–µ), –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å–µ–∫—Ü–∏—è CORS –¥–ª—è –∞–¥–º–∏–Ω‚ÄëUI.
* [ ] **–ö—ç—à KV (read‚Äëthrough)**: –∫–ª—é—á–∏ `list:<ns>:<lang|*>:<active|*>` (TTL~60s), `id:<id>` (TTL~300s), `default:<ns>:<lang>` (TTL~300s); –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ CRUD.
* [ ] **–§—Ä–æ–Ω—Ç‚Äë—Ñ–æ—Ä–º–∞**: –ø–æ–ª—è *–Ω–∞–∑–≤–∞–Ω–∏–µ*, *—Ç–µ–∫—Å—Ç*, —á–µ–∫–±–æ–∫—Å *default*; –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–µ—Ä—Å–∏–π, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ active, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `tags`.
* [ ] **–ü–æ–∏—Å–∫**: `q` –ø–æ name/text; `tag` —á–µ—Ä–µ–∑ JSON1 (`json_each`), –ø–∞–≥–∏–Ω–∞—Ü–∏—è (limit/offset –∏–ª–∏ cursor).
* [ ] **Seed/backup**: —Å–∏–¥ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤; —ç–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç D1 (CLI); —Ö—Ä–∞–Ω–µ–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–æ–≤ –≤ R2.
* [ ] **–£–Ω–∏–∫–∞–ª—å–Ω—ã–π default**: —á–∞—Å—Ç–∏—á–Ω—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω) –∏–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ –≤–æ—Ä–∫–µ—Ä–µ.
* [ ] **–ë—É–¥—É—â–µ–µ**: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Vectorize –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –ø—Ä–æ–º–ø—Ç–∞–º.

---

## ‚úÖ –°—Ç–∞—Ç—É—Å

* ‚úî Worker –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ Cloudflare.
* ‚úî API –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ JSON –∏ multipart, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç SSE (—Å—Ç—Ä–∏–º–∏–Ω–≥).
* ‚úî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ (`images[]`).
* ‚úî (–µ—Å–ª–∏ —Ñ—Ä–æ–Ω—Ç –ø–æ–¥–∫–ª—é—á—ë–Ω –≤–æ –≤–Ω–µ—à–Ω–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏) —Ñ—Ä–æ–Ω—Ç —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏/–∏–ª–∏ –Ω–∞ Vercel, —É–º–µ–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –æ—Ç–≤–µ—Ç—ã.

## –õ–∏—Ü–µ–Ω–∑–∏—è
MIT.

